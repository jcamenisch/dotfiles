UV_DIR=$(cd $HOME/../uservoice 2>/dev/null && pwd)
if [[ -d $UV_DIR ]]; then
  export UV_RAILS_DIR="$UV_DIR/uservoice"
  export UV_SIDEBAR_DIR="$UV_DIR/sidebar"
  export UV_ZENDESK_DIR="$UV_DIR/zendesk"
  export UV_METROID_DIR="$UV_DIR/metroid"
  export UV_SILLYPUTTY_DIR="$UV_DIR/sillyputty"
  export UV_SUPERADMIN_DIR="$UV_DIR/superadmin"
fi

orc_random_worker() {
  echo worker5; return

  WORKERS=($(cat $UV_RAILS_DIR/config/deploy/production.rb | grep -o 'worker\d\+' | sort | uniq))
  echo ${WORKERS[$RANDOM % ${#WORKERS[@]-1} + 1]}
  unset WORKERS
}

safe_alias omyw "orc mysql \$(orc_random_worker)"
safe_alias orw "orc rails \$(orc_random_worker)"
safe_alias osw "orc ssh \$(orc_random_worker)"

safe_alias od "orc deploy"
safe_alias ol "orc logs"

safe_alias om "orc migrate"
safe_alias omy "orc mysql"
safe_alias or "orc rails"
safe_alias os "orc ssh"

osbroadcast() {
  for s in $(echo $1); do
    orc ssh $s "$2"
  done
}

osdev() {
  orc ssh $1 'sudo su - dev'
}

osmux() {
  orc ssh $1 "tmux attach || [ -f /home/j2d2/.jcamenisch/tmux.conf ] && tmux -f /home/j2d2/.jcamenisch/tmux.conf || tmux"
}

osmuxd() {
  orc ssh $1 "sudo su -lc 'tmux attach || [ -f /home/j2d2/.jcamenisch/tmux.conf ] && tmux -f /home/j2d2/.jcamenisch/tmux.conf || tmux' dev"
}

osmuxm() {
  orc ssh admin "sudo su -lc 'tmux -S /tmp/migration attach || tmux -S /tmp/migration' dev"
}

osp() {
  orc ssh $1 ".jcamenisch/shell"
}

ostatus() {
  for id in $(orc nomad status $1 | awk '/run +running/ { print $1 }'); do
    orc nomad alloc-status $id;
    echo; echo
  done
}
